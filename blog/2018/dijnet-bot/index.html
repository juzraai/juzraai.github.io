<!DOCTYPE html> <html lang="hu"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta http-equiv="X-UA-Compatible" content="ie=edge"> <!-- Begin Jekyll SEO tag v2.5.0 --> <title>Díjnet bot | Zsolt Jurányi (juzraai)</title> <meta name="generator" content="Jekyll v3.8.5" /> <meta property="og:title" content="Díjnet bot" /> <meta name="author" content="Zsolt Jurányi" /> <meta property="og:locale" content="hu_HU" /> <meta name="description" content="A Díjnet csak bizonyos ideig őrzi meg a számlákat, a kézi lementés pedig fárasztó dolog. Szerencsére a feladat könnyen automatizálható, írtam rá egy szkriptet Node.js-ben. :)" /> <meta property="og:description" content="A Díjnet csak bizonyos ideig őrzi meg a számlákat, a kézi lementés pedig fárasztó dolog. Szerencsére a feladat könnyen automatizálható, írtam rá egy szkriptet Node.js-ben. :)" /> <link rel="canonical" href="https://juzraai.github.io/blog/2018/dijnet-bot/" /> <meta property="og:url" content="https://juzraai.github.io/blog/2018/dijnet-bot/" /> <meta property="og:site_name" content="Zsolt Jurányi (juzraai)" /> <meta property="og:image" content="https://juzraai.github.io/assets/facebook-og-image.png" /> <meta property="og:image:height" content="630" /> <meta property="og:image:width" content="1200" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2018-12-14T00:00:00+01:00" /> <script type="application/ld+json"> {"description":"A Díjnet csak bizonyos ideig őrzi meg a számlákat, a kézi lementés pedig fárasztó dolog. Szerencsére a feladat könnyen automatizálható, írtam rá egy szkriptet Node.js-ben. :)","author":{"@type":"Person","name":"Zsolt Jurányi"},"@type":"BlogPosting","url":"https://juzraai.github.io/blog/2018/dijnet-bot/","image":{"width":1200,"height":630,"url":"https://juzraai.github.io/assets/facebook-og-image.png","@type":"imageObject"},"headline":"Díjnet bot","dateModified":"2018-12-14T00:41:29+01:00","datePublished":"2018-12-14T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://juzraai.github.io/blog/2018/dijnet-bot/"},"@context":"http://schema.org"}</script> <!-- End Jekyll SEO tag --> <meta property="og:image:type" content="image/png" /> <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"> <link rel="manifest" href="/site.webmanifest"> <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#016fb9"> <meta name="msapplication-TileColor" content="#016fb9"> <meta name="theme-color" content="#016fb9"> <link type="application/atom+xml" rel="alternate" href="https://juzraai.github.io/feed.xml" title="Zsolt Jurányi (juzraai)" /> <link rel="dns-prefetch" href="//fonts.googleapis.com/"> <link rel="dns-prefetch" href="//cdnjs.cloudflare.com"> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Barlow+Condensed:300,300i,400,500,600|Inconsolata:400,700&amp;subset=latin-ext" /> <link rel="stylesheet" href="/assets/page.css" /> </head> <body> <nav class="navbar navbar-expand-lg navbar-dark bg-dark"> <div class="container"> <a class="navbar-brand" href="/">Zsolt</a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <div class="collapse navbar-collapse" id="navbarSupportedContent"> <ul class="navbar-nav mr-auto w-100"> <li class="nav-item"> <a class="nav-link" href="/projects/hu/" target="">Munkáim</a> </li> <li class="nav-item"> <a class="nav-link" href="/blog/hu/" target="">Feljegyzéseim</a> </li> <li class="nav-item"> <a class="nav-link" href="https://github.com/juzraai" target="_blank">GitHub</a> </li> <li class="nav-item"> <a class="nav-link" href="/contact/hu/" target="">Kontakt</a> </li> </ul> </div> </div> </nav> <div class="container"> <div class="row my-5 border-bottom"> <div class="col"> <div class="mb-3 text-muted"> Dec 14, 2018 / <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/backup/">#backup</a> <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/bot/">#bot</a> <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/crawler/">#crawler</a> <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/dijnet/">#díjnet</a> <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/invoice/">#invoice</a> <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/nodejs/">#nodejs</a> <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/project/">#project</a> <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/script/">#script</a> </div> <h1>Díjnet bot</h1> </div> </div> <div class="row"> <div class="col content"> <ul class="list-unstyled mb-5 toc"> <li><a href="#a-probléma">A probléma</a></li> <li><a href="#megoldásom">Megoldásom</a></li> <li><a href="#nehézségek">Nehézségek</a></li> <li><a href="#tervek">Tervek</a></li> </ul> <h2 id="a-probléma">A probléma</h2> <p>A közüzemi számlák befizetésének egyik legkényelmesebb módja a <a href="https://www.dijnet.hu/">Díjnet</a>. Emailt küld a számláról, ami webes felületről letölthető, és online bankkártyás fizetési lehetőséget biztosít, amellyel több számla is kiegyenlíthető egyetlen tranzakcióval.</p> <p><strong>Az ingyenes szolgáltatás keretében a Díjnet az utolsó 18 hónap számláit tárolja.</strong> Ha a fájlokat később is el akarjuk érni, akkor két választásunk van:</p> <ul> <li>vagy lementjük a számlákat kézzel</li> <li>vagy fizetünk a <a href="https://www.dijnet.hu/ekonto/docs/hu/szamlaplusz_tajekoztato.pdf">SzámlaPlusz</a> nevű szolgáltatásért (évi ~1000 Ft)</li> </ul> <p>A fizetős csomag - valljuk be - egyáltalán nem drága, az alább írtak ellenére én is előfizettem rá.</p> <p>Van viszont úgy, hogy szeretnénk ezeket a fájlokat (mégis) a saját gépünkön tudni, hogy kéznél legyenek. Itt jönne az, hogy <strong>kézzel lementjük őket</strong> - viszont sok számlát eléggé időigényes és fárasztó lenne letöltögetni egyesével, érdemes a <strong>feladatot automatizálni.</strong></p> <p>Mielőtt belefogtam a projektbe, azért körbenéztem, és nem meglepő módon nem nekem jutott eszembe először egy Díjnet számla letöltő szkript megírása. GitHub-on 2-3 repót találtam, ezek közül a <a href="https://github.com/wolandmaster/dijnet-dump">wolandmaster/dijnet-dump</a> megvalósítás ahogy látom, viszonylag frissen is van tartva. Én ezt nem próbáltam ki, mert kihívást éreztem abban, hogy magam is összerakjak egy ilyen programot nulláról, elsősorban saját célra, saját igények szerint.</p> <h2 id="megoldásom">Megoldásom</h2> <p>Nekiültem tehát összerakni a saját crawler-emet. Először Bash-ban csináltam meg <code class="highlighter-rouge">curl</code>-el, de aztán Node.js-re váltottam, főként azért, mert ott kényelmesen tudok HTML-t is parszolni, illetve könnyebben futtatható lesz a szkript Windows-on is. Csak <a href="https://nodejs.org/en/">Node.js</a>-t kell telepíteni hozzá.</p> <p>Összeraktam a <strong>Díjnet botot</strong>, amely <strong>automatikusan le tudja tölteni az összes Díjnet-en levő számlámat és azok minden fájlját</strong>, vagyis így meglesz a gépen minden számla PDF és XML formátumban, illetve a terhelési összesítők is, ahol van ilyen. A <strong>fájlokat mappázza szolgáltató, szolgáltatási azonosító és dátum szerint.</strong></p> <p>Grafikus felületet nem csináltam neki, <strong>parancssorból futtatható</strong>. A beállításokat és a bejelentkezési adatokat fájlból olvassa, így ideális arra is, hogy <strong>ütemezett feladatként</strong> legyen futtatva.</p> <p><strong><a href="https://github.com/juzraai/dijnet-bot/">A program részletesebb leírással együtt GitHub-on érhető el.</a></strong></p> <p>Nálam gyönyörűen működik, legalábbis UPC, FVM és FCSM számlákkal nincs gondja.</p> <p><a href="/assets/dijnet-bot/dijnet-bot-run.png"><img src="/assets/dijnet-bot/dijnet-bot-run.png" alt="Díjnet bot futás" /></a></p> <h2 id="nehézségek">Nehézségek</h2> <p>Fura volt, hogy a Díjneten meg kell nyitni a számla kereső űrlapot, mielőtt elküldeném az adatait, illetve a számla listához is vissza kell térni minden számla után, hogy a következőre rámehessek. Így sajnos jóval több request-be kerül az egész procedúra, mint egy átlagos weboldal esetében.</p> <p>Figyelni kellett a HTTP header-ökre is, bizonyos URL-ekre kontent nélküli lapot dob a szerver, ha hiányzik az <code class="highlighter-rouge">Accept</code> és <code class="highlighter-rouge">Accept-Language</code>.</p> <p>A karakterkódolás is elég fura, amit használnak. Na ennek a nyitjára még nem jöttem rá, próbáltam jobbra-balra konvertálni, de csak nem kaptam szép ő/ű betűket. Egyelőre úgy hidaltam át, hogy az ékezeteket leveszem (á » a), az ismeretlen karaktereket meg kidobálom.</p> <h2 id="tervek">Tervek</h2> <p>Azért van még pár ötlet a tarsolyomban a Díjnet bot továbbfejlesztéséhez. Gondolkozom azon, hogy <strong>valamiféle statisztikát</strong> is generálhatna a számla infók alapján. Például átlagolhatná a havi kiadást, vagy tehetne javaslatot az <strong>optimális számlafizetési napra,</strong> amikor minél több számlát ki tudok fizetni egyetlen kattintással és tranzakcióval.</p> </div> </div> <div class="row mt-3"> <div class="col text-center"> <script> if (!window.scripts) window.scripts = []; window.scripts = window.scripts.concat('https://connect.facebook.net/hu_HU/sdk.js#xfbml=1&version=v3.0'); </script> <div class="fb-like" data-href="https://juzraai.github.io/blog/2018/dijnet-bot/" data-layout="button_count" data-action="like" data-size="large" data-show-faces="false" data-share="true"></div> </div> </div> <div class="row my-5 border-top"> <div class="col-md-8 mt-3"> <big class="font-weight-normal text-dark"> <strong>Zsolt vagyok,</strong> full-stack fejlesztő. </big> <br> Crawlereket, webalkalmazásokat, statikus honlapokat és interaktív vizualizációkat készítek. </div> <div class="col mt-3 small"> <ul class="list-unstyled d-flex d-md-block pl-md-3"> <li class="mr-3 mr-md-0"><a href="/projects/hu/" target="">Munkáim</a></li> <li class="mr-3 mr-md-0"><a href="/blog/hu/" target="">Feljegyzéseim</a></li> <li class="mr-3 mr-md-0"><a href="https://github.com/juzraai" target="_blank">GitHub</a></li> <li class="mr-3 mr-md-0"><a href="/contact/hu/" target="">Kontakt</a></li> </ul> </div> </div> <div class="row"> <div class="col mb-3 small text-center text-muted"> Copyright &copy; 2018 Zsolt Jurányi | All rights reserved. </div> </div> </div> <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.1/js/bootstrap.min.js"></script> <script>$(function () { $('a[href^=http]').attr('target', '_blank'); })</script> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fluidbox/2.0.5/css/fluidbox.min.css"> <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-throttle-debounce/1.1/jquery.ba-throttle-debounce.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/fluidbox/2.0.5/js/jquery.fluidbox.min.js"></script> <script> $(function () { $('.content a').fluidbox(); }); </script> <script> if (!window.scripts) window.scripts = []; window.scripts = window.scripts.concat('https://www.googletagmanager.com/gtag/js?id=UA-41050675-1'); window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-41050675-1', { 'anonymize_ip': true }); </script> <div id="cc" style="display:none"> <div class="c" onclick="ccClear()"></div> <div class="p"> <p> A honlap helyes működéséhez és némi statisztikához szeretnék sütiket használni. <a href="/privacy/hu/">Részletek</a> </p> <div class="r"> <a href="javascript:void(0)" onclick="ccDeny()">Elrejtés</a> <a class="b" href="javascript:void(0)" onclick="ccAllow()">Engedélyezem</a> </div> </div> </div> <script> /* js-cookie v2.2.0 */ !function(e){var n=!1;if("function"==typeof define&&define.amd&&(define(e),n=!0),"object"==typeof exports&&(module.exports=e(),n=!0),!n){var o=window.Cookies,t=window.Cookies=e();t.noConflict=function(){return window.Cookies=o,t}}}(function(){function e(){for(var e=0,n={};e<arguments.length;e++){var o=arguments[e];for(var t in o)n[t]=o[t]}return n}function n(o){function t(n,r,i){var c;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(i=e({path:"/"},t.defaults,i)).expires){var a=new Date;a.setMilliseconds(a.getMilliseconds()+864e5*i.expires),i.expires=a}i.expires=i.expires?i.expires.toUTCString():"";try{/^[\{\[]/.test(c=JSON.stringify(r))&&(r=c)}catch(e){}r=o.write?o.write(r,n):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),n=(n=(n=encodeURIComponent(String(n))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var s="";for(var f in i)i[f]&&(s+="; "+f,!0!==i[f]&&(s+="="+i[f]));return document.cookie=n+"="+r+s}n||(c={});for(var p=document.cookie?document.cookie.split("; "):[],d=/(%[0-9A-Z]{2})+/g,u=0;u<p.length;u++){var l=p[u].split("="),C=l.slice(1).join("=");this.json||'"'!==C.charAt(0)||(C=C.slice(1,-1));try{var g=l[0].replace(d,decodeURIComponent);if(C=o.read?o.read(C,g):o(C,g)||C.replace(d,decodeURIComponent),this.json)try{C=JSON.parse(C)}catch(e){}if(n===g){c=C;break}n||(c[g]=C)}catch(e){}}return c}}return t.set=t,t.get=function(e){return t.call(t,e)},t.getJSON=function(){return t.apply({json:!0},[].slice.call(arguments))},t.defaults={},t.remove=function(n,o){t(n,"",e(o,{expires:-1}))},t.withConverter=n,t}return n(function(){})}); function addClass(element, className) { element.className += ' ' + className; } function removeClass(element, className) { element.className = element.className.replace( new RegExp('( |^)' + className + '( |$)', 'g'), ' ').trim(); } var c = 'juzraai-cc-v1'; function ccInit() { var v = Cookies.get(c); var e = document.getElementById('cc'); if ('allow' == v) { e.style.display = 'none'; ccLoadScripts(); } else { if ('deny' == v) { addClass(e, 'small'); } else { removeClass(e, 'small'); } e.style.display = null; } } function ccAllow() { Cookies.set(c, 'allow', { expires: 365 }); ccInit(); } function ccClear() { Cookies.remove(c); ccInit(); } function ccDeny() { Cookies.set(c, 'deny', { expires: 7 }); ccInit(); } function ccLoadScripts() { if (!window.scripts) window.scripts = []; for (var i = 0; i < window.scripts.length; i++) { var script = document.createElement('script'); script.src = window.scripts[i]; document.body.appendChild(script); } } ccInit(); </script> </body> </html>
