<!DOCTYPE html> <html lang="hu"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta http-equiv="X-UA-Compatible" content="ie=edge"> <!-- Begin Jekyll SEO tag v2.5.0 --> <title>Heritrix 3 konfig receptk√∂nyv | Zsolt Jur√°nyi (juzraai)</title> <meta name="generator" content="Jekyll v3.8.3" /> <meta property="og:title" content="Heritrix 3 konfig receptk√∂nyv" /> <meta name="author" content="Zsolt Jur√°nyi" /> <meta property="og:locale" content="hu_HU" /> <meta name="description" content="N√©h√°ny konfigur√°ci√≥s l√©p√©s √©s tapasztalat, k√ºl√∂nb√∂z≈ë szitu√°ci√≥khoz Heritrix 3-mal t√∂rt√©n≈ë weboldal archiv√°l√°shoz." /> <meta property="og:description" content="N√©h√°ny konfigur√°ci√≥s l√©p√©s √©s tapasztalat, k√ºl√∂nb√∂z≈ë szitu√°ci√≥khoz Heritrix 3-mal t√∂rt√©n≈ë weboldal archiv√°l√°shoz." /> <link rel="canonical" href="https://juzraai.github.io/blog/2013/heritrix-3-konfig-receptkonyv/" /> <meta property="og:url" content="https://juzraai.github.io/blog/2013/heritrix-3-konfig-receptkonyv/" /> <meta property="og:site_name" content="Zsolt Jur√°nyi (juzraai)" /> <meta property="og:image" content="https://juzraai.github.io/assets/facebook-og-image.png" /> <meta property="og:image:height" content="630" /> <meta property="og:image:width" content="1200" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2013-10-04T00:00:00+02:00" /> <script type="application/ld+json"> {"description":"N√©h√°ny konfigur√°ci√≥s l√©p√©s √©s tapasztalat, k√ºl√∂nb√∂z≈ë szitu√°ci√≥khoz Heritrix 3-mal t√∂rt√©n≈ë weboldal archiv√°l√°shoz.","author":{"@type":"Person","name":"Zsolt Jur√°nyi"},"@type":"BlogPosting","url":"https://juzraai.github.io/blog/2013/heritrix-3-konfig-receptkonyv/","image":{"width":1200,"height":630,"url":"https://juzraai.github.io/assets/facebook-og-image.png","@type":"imageObject"},"headline":"Heritrix 3 konfig receptk√∂nyv","dateModified":"2018-06-24T12:44:37+02:00","datePublished":"2013-10-04T00:00:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://juzraai.github.io/blog/2013/heritrix-3-konfig-receptkonyv/"},"@context":"http://schema.org"}</script> <!-- End Jekyll SEO tag --> <meta property="og:image:type" content="image/png" /> <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"> <link rel="manifest" href="/site.webmanifest"> <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#016fb9"> <meta name="msapplication-TileColor" content="#016fb9"> <meta name="theme-color" content="#016fb9"> <link type="application/atom+xml" rel="alternate" href="https://juzraai.github.io/feed.xml" title="Zsolt Jur√°nyi (juzraai)" /> <link rel="dns-prefetch" href="//fonts.googleapis.com/"> <link rel="dns-prefetch" href="//cdnjs.cloudflare.com"> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Barlow+Condensed:300,300i,400,500,600|Inconsolata:400,700&amp;subset=latin-ext" /> <link rel="stylesheet" href="/assets/page.css" /> </head> <body> <nav class="navbar navbar-expand-lg navbar-dark bg-dark"> <div class="container"> <a class="navbar-brand" href="/">Zsolt</a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <div class="collapse navbar-collapse" id="navbarSupportedContent"> <ul class="navbar-nav mr-auto w-100"> <li class="nav-item"> <a class="nav-link" href="/projects/hu/" target="">Munk√°im</a> </li> <li class="nav-item"> <a class="nav-link" href="/blog/hu/" target="">Feljegyz√©seim</a> </li> <li class="nav-item"> <a class="nav-link" href="https://github.com/juzraai" target="_blank">GitHub</a> </li> <li class="nav-item"> <a class="nav-link" href="/contact/hu/" target="">Kontakt</a> </li> </ul> </div> </div> </nav> <div class="container"> <div class="row my-5 border-bottom"> <div class="col"> <div class="mb-3 text-muted"> Oct 4, 2013 / <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/crawling/">#crawling</a> <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/heritrix/">#heritrix</a> <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/konfiguracio/">#konfigur√°ci√≥</a> <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/tapasztalat/">#tapasztalat</a> </div> <h1>Heritrix 3 konfig receptk√∂nyv</h1> </div> </div> <div class="row"> <div class="col content"> <ul class="list-unstyled mb-5 toc"> <li><a href="#1-kezd≈ë-l√©p√©sek">1. Kezd≈ë l√©p√©sek</a> <ul> <li><a href="#11-url-ek-hozz√°ad√°sa">1.1. URL-ek hozz√°ad√°sa</a></li> <li><a href="#12-oper√°tor-kontakt-c√≠me">1.2. Oper√°tor kontakt c√≠me</a></li> </ul> </li> <li><a href="#2-testreszab√°s">2. Testreszab√°s</a> <ul> <li><a href="#21-t√°rol√°si-m√≥d">2.1. T√°rol√°si m√≥d</a></li> <li><a href="#22-domain-en-bel√ºl-marad√°s">2.2. Domain-en bel√ºl marad√°s</a></li> <li><a href="#23-bizonyos-url-mint√°k-tilt√°sa">2.3. Bizonyos URL mint√°k tilt√°sa</a></li> <li><a href="#24-gyors√≠t√°s">2.4. Gyors√≠t√°s</a></li> <li><a href="#25-robotstxt-figyelmen-k√≠v√ºl-hagy√°sa">2.5. robots.txt figyelmen k√≠v√ºl hagy√°sa</a></li> <li><a href="#26-saj√°t-user-agent-megad√°sa">2.6. Saj√°t User-agent megad√°sa</a></li> <li><a href="#27-auto-pause-kikapcsol√°sa">2.7. Auto pause kikapcsol√°sa</a></li> </ul> </li> <li><a href="#3-megfigyel√©sek">3. Megfigyel√©sek</a> <ul> <li><a href="#31-mem√≥riaig√©ny">3.1. Mem√≥riaig√©ny</a></li> <li><a href="#32-url-probl√©m√°k">3.2. URL probl√©m√°k</a></li> </ul> </li> </ul> <p>Gondoltam megosztom a tapasztalatokat, h√°tha akad olyan ‚Äúelvetem√ºlt‚Äù, aki szint√©n <a href="https://webarchive.jira.com/wiki/spaces/Heritrix/overview">Heritrix</a>-szel akar neki√°llni site-okat archiv√°lni. ü§™ Az al√°bbiakban le√≠rom azokat a be√°ll√≠t√°si lehet≈ës√©geket, amelyek munk√°m sor√°n el≈ëj√∂ttek, fontosak voltak.</p> <p>A konfigur√°ci√≥t Heritrix-ben job-onk√©nt lehet elv√©gezni, a <code class="highlighter-rouge">crawler-beans.cxml</code> f√°jl m√≥dos√≠t√°s√°val.</p> <h2 id="1-kezd≈ë-l√©p√©sek">1. Kezd≈ë l√©p√©sek</h2> <h3 id="11-url-ek-hozz√°ad√°sa">1.1. URL-ek hozz√°ad√°sa</h3> <p>A legfontosabb dolog egy job-n√°l a forr√°s URL-ek hozz√°ad√°sa, vagyis: honnan induljon a let√∂lt√©s? A CXML-ben keress√ºk meg ezt a r√©szt:</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"longerOverrides"</span> <span class="na">class=</span><span class="s">"org.springframework.beans.factory.config.PropertyOverrideConfigurer"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"properties"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;props&gt;</span>
      <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">"seeds.textSource.value"</span><span class="nt">&gt;</span>

        # URLS HERE

      <span class="nt">&lt;/prop&gt;</span>
    <span class="nt">&lt;/props&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></div> <p>Itt az URL-eket soronk√©nt √≠rhatjuk be.</p> <h3 id="12-oper√°tor-kontakt-c√≠me">1.2. Oper√°tor kontakt c√≠me</h3> <p>A Heritrix <strong>megk√∂veteli, hogy be√≠rjunk egy URL-t,</strong> ami a let√∂lt√©st v√©gz≈ë egy√©n/szervezet honlapj√°ra mutat. Ez az URL hozz√° lesz adva a <code class="highlighter-rouge">User-agent</code> param√©terhez. (Lesz m√©g sz√≥ r√≥la a 2.6.-os bekezd√©sben.) Nyilv√°n ez a felel≈ëss√©g miatt kell, hogy ha leterhelj√ºk valakinek a szerver√©t egy izmos crawl futammal, √©s az nemtetsz√©st v√°lt ki, akkor vissza lehessen keresni minket.</p> <p>Keress√ºnk r√° az al√°bbira, hogy megtal√°ljuk, hova kell √≠rni ezt a c√≠met:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>metadata.operatorContactUrl=
</code></pre></div></div> <h2 id="2-testreszab√°s">2. Testreszab√°s</h2> <h3 id="21-t√°rol√°si-m√≥d">2.1. T√°rol√°si m√≥d</h3> <p>A Heritrix 3 alapesetben <a href="https://en.wikipedia.org/wiki/Web_ARChive">WARC</a> f√°jlokba √≠rja a let√∂lt√∂tt adatokat. El≈ëfordulhatnak esetek, amikor nek√ºnk nem erre van sz√ºks√©g√ºnk, hanem esetleg konkr√©tan a f√°jlokra, vagy esetleg WARC helyett <a href="https://en.wikipedia.org/wiki/ARC_(file_format)">ARC</a> f√°jlokra.</p> <p>Ehhez a <code class="highlighter-rouge">warcWriter</code> bean class param√©ter√©t kell megfelel≈ëen be√°ll√≠tanunk:</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"warcWriter"</span> <span class="na">class=</span><span class="s">"org.archive.modules.writer.WARCWriterProcessor"</span><span class="nt">&gt;</span>
</code></pre></div></div> <p>Lehet≈ës√©gek (a package ugyanaz):</p> <ul> <li><code class="highlighter-rouge">WARCWriterProcessor</code></li> <li><code class="highlighter-rouge">ARCWriterProcessor</code></li> <li><code class="highlighter-rouge">MirrorWriterProcessor</code> - ez t√ºkr√∂zi a mappaszerkezetet</li> </ul> <h3 id="22-domain-en-bel√ºl-marad√°s">2.2. Domain-en bel√ºl marad√°s</h3> <p>Ha egy site-ot archiv√°lunk, √°ltal√°ban nem akarjuk k√∂vetni az √∂sszes linket a v√©gtelens√©gig rekurz√≠van, mert v√©gtelen id≈ënk √©s t√°rkapacit√°sunk nincs. Az lenne a c√©l, hogy a rekurz√≠v bej√°r√°s az adott <strong>kiindu√°lis domain-re szor√≠tkozzon, ne l√©pjen ki onnan.</strong></p> <p>Ezt egy Heritrix 3 job eset√©n √∫gy tehetj√ºk meg, hogy az al√°bbi bean-t konkr√©tan kit√∂r√∂lj√ºk/kikommentezz√ºk a config CXML-b≈ël:</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--
  &lt;bean class="org.archive.modules.deciderules.TransclusionDecideRule"&gt;
    ...
  &lt;/bean&gt;
--&gt;</span>
</code></pre></div></div> <h3 id="23-bizonyos-url-mint√°k-tilt√°sa">2.3. Bizonyos URL mint√°k tilt√°sa</h3> <p>Azon t√∫l, hogy domain-en maradunk, site-on bel√ºl is lehetnek olyan r√©szek, amik minket nem √©rdekelnek, esetleg f√°jlt√≠pusok, vagy ak√°r <strong>crawler csapd√°k</strong> (pl. egy v√©gtelen calendar, ami r√°ad√°sul minden aloldalr√≥l el√©rhet≈ë k√ºl√∂nb√∂z≈ë URL-en).</p> <p>Ezeket <strong>regul√°ris kifejez√©sek</strong> form√°j√°ban mondhatjuk meg a Heritrix-nek, hogy ker√ºlje el:</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"scope"</span> <span class="na">class=</span><span class="s">"org.archive.modules.deciderules.DecideRuleSequence"</span><span class="nt">&gt;</span>
  ...
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"rules"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;list&gt;</span>

      ...

      <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.archive.modules.deciderules.MatchesListRegexDecideRule"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"decision"</span> <span class="na">value=</span><span class="s">"REJECT"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"regexList"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;list&gt;</span>
            <span class="nt">&lt;value&gt;</span>regexp1<span class="nt">&lt;/value&gt;</span>
              ...
            <span class="nt">&lt;value&gt;</span>regexpN<span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;/list&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
      <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/list&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></div> <h3 id="24-gyors√≠t√°s">2.4. Gyors√≠t√°s</h3> <p>A Heritrix alapb√≥l nagyon kom√≥tosan t√∂lt, ak√°r m√°sodperceket is v√°r URL-enk√©nt. A konfigban √©n 2 helyet tal√°ltam, ahol fel lehet turb√≥zni a dolgot:</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"disposition"</span> <span class="na">class=</span><span class="s">"org.archive.crawler.postprocessor.DispositionProcessor"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"delayFactor"</span> <span class="na">value=</span><span class="s">"1.0"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"minDelayMs"</span> <span class="na">value=</span><span class="s">"100"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"respectCrawlDelayUpToSeconds"</span> <span class="na">value=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"maxDelayMs"</span> <span class="na">value=</span><span class="s">"100"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></div> <p>Illetve:</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">'veryPolite'</span> <span class="na">class=</span><span class="s">'org.archive.spring.Sheet'</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">'map'</span><span class="nt">&gt;</span>
    <span class="nt">&lt;map&gt;</span>
      <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">'disposition.delayFactor'</span> <span class="na">value=</span><span class="s">'1'</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">'disposition.minDelayMs'</span> <span class="na">value=</span><span class="s">'100'</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">'disposition.maxDelayMs'</span> <span class="na">value=</span><span class="s">'1000'</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">'disposition.respectCrawlDelayUpToSeconds'</span> <span class="na">value=</span><span class="s">'1'</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/map&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></div> <p>Az egyes property-k √©rt√©keinek magyar√°zat√°hoz l√°sd a <a href="https://webarchive.jira.com/wiki/spaces/Heritrix/pages/5407381/Heritrix+3.0+and+3.1+User+Guide">doksit</a>.</p> <h3 id="25-robotstxt-figyelmen-k√≠v√ºl-hagy√°sa">2.5. robots.txt figyelmen k√≠v√ºl hagy√°sa</h3> <p>A <a href="https://support.google.com/webmasters/answer/6062608?hl=hu">robots.txt</a>-ben a webszerverek bizonyos robotokat, b√∂ng√©sz≈ëket (vagy ak√°r mindenf√©le programot) tilthatnak el bizonyos mapp√°kt√≥l, illetve crawl delay-t is megszabhatnak. Persze ezek <strong>csak inform√°ci√≥k, aj√°nl√°sok a programoknak,</strong> az m√°r egy m√°sik k√©rd√©s, hogy be is akarj√°k-e ezt tartani. A Heritrix persze alapvet≈ëen illedelmes robot, betartja, amit e szab√°lyzatban megszabnak neki, de szerencs√©re tartalmaz konfigur√°l√°si lehet≈ës√©get a <code class="highlighter-rouge">robots.txt</code> ignor√°l√°s√°ra.</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"metadata"</span> <span class="na">class=</span><span class="s">"org.archive.modules.CrawlMetadata"</span> <span class="na">autowire=</span><span class="s">"byName"</span><span class="nt">&gt;</span>
  ...
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"robotsPolicyName"</span> <span class="na">value=</span><span class="s">"ignore"</span><span class="nt">/&gt;</span>
  ...
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></div> <h3 id="26-saj√°t-user-agent-megad√°sa">2.6. Saj√°t User-agent megad√°sa</h3> <p>Vannak olyan site-ok, ahol ak√°r <code class="highlighter-rouge">robots.txt</code> szab√°lyokkal, ak√°r egy szerveroldali szkript seg√≠ts√©g√©vel sz≈±rik, hogy milyen b√∂ng√©sz≈ëvel lehet ≈ëket megl√°togatni. A <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent">User-agent</a> HTTP param√©ter szolg√°l arra, hogy megnevezze a HTTP k√©r√©st k√ºld≈ë programot √©s annak verzi√≥j√°t, illetve esetleg a platformot, amin fut. Az ilyen sz≈±r√©seket nagyon egyszer≈± kiker√ºlni: be√°ll√≠tjuk ennek a param√©ternek az √©rt√©k√©t mondjuk egy n√©pszer≈± b√∂ng√©sz≈ë√©re.</p> <p>Heritrix-ben is be√°ll√≠that√≥ ez term√©szetesen, viszont annyi megk√∂t√©s van, hogy <strong>a Heritrix verzi√≥sz√°m√°nak √©s az oper√°tor URL-nek (l√°sd 1.2) szerepelnie kell benne.</strong> A konfigf√°jlban egy template string-et kell megadni, amiben szerepel egyr√©szt a <code class="highlighter-rouge">@VERSION@</code>, m√°sr√©szt a <code class="highlighter-rouge">+@OPERATOR_CONTACT_URL@</code> karakterl√°nc. Felh√≠vom a figyelmet, hogy a <code class="highlighter-rouge">+</code> jel is kell, k√ºl√∂nben hib√°t jelez a Heritrix a job build-el√©sekor.</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"metadata"</span> <span class="na">class=</span><span class="s">"org.archive.modules.CrawlMetadata"</span> <span class="na">autowire=</span><span class="s">"byName"</span><span class="nt">&gt;</span>
  ...
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"userAgentTemplate"</span> <span class="na">value=</span><span class="s">"Mozilla/5.0 (compatible; heritrix/@VERSION@ +@OPERATOR_CONTACT_URL@)"</span><span class="nt">/&gt;</span>
  ...
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></div> <h3 id="27-auto-pause-kikapcsol√°sa">2.7. Auto pause kikapcsol√°sa</h3> <p>A Heritrix-nek van egy olyan √©rdekess√©ge, hogy alap√©rtelmez√©sben ha egy job-ot elind√≠tasz, r√∂gt√∂n lepauz√°lja. K√ºl√∂n r√° kell menned az unpause gombra, hogy t√©nylegesen meginduljon a let√∂lt√©s. (√ârdekes dolog, √©n m√©g nem j√∂ttem r√° mire j√≥ ez‚Ä¶ ha elind√≠tok egy job-ot, akkor az√©rt ind√≠tom el, hogy t√∂lts√∂n, nem? üòÉ) De ezt is ki lehet kapcsolni, itt:</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"crawlController"</span> <span class="na">class=</span><span class="s">"org.archive.crawler.framework.CrawlController"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"pauseAtStart"</span> <span class="na">value=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></div> <h2 id="3-megfigyel√©sek">3. Megfigyel√©sek</h2> <h3 id="31-mem√≥riaig√©ny">3.1. Mem√≥riaig√©ny</h3> <p>A doksi azt √≠rja, hogy az alap√©rtelmezett 256MB heap mem√≥ria t√∂bb sz√°z oldal let√∂lt√©s√©hez j√≥. Tapasztalatom szerint 8-10 <strong>p√°rhuzamosan fut√≥ job</strong>-t√≥l konkr√©tan meghal az eg√©sz <code class="highlighter-rouge">OutOfMemoryException</code>-nel, sz√≥val az <code class="highlighter-rouge">Xmx</code> param√©tert √©rdemes megadni, √©s <strong>GB-okban kell gondolkodni.</strong> √ân speciel 3GB-ot adok neki, ez el√©g arra, hogy 10 job fusson p√°rhuzamosan.</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export HERITRIX_HOME=/path/to/heritrix-3.1.1
export JAVA_HOME=/path/to/jre
export JAVA_OPTS=-Xmx3G
$HERITRIX_HOME/bin/heritrix -a admin:admin
</code></pre></div></div> <p>Amit m√©g √©rdemes megtenni: az √©pp nem fut√≥ <strong>job-okat teardown-olni</strong>, ha sok van.</p> <h3 id="32-url-probl√©m√°k">3.2. URL probl√©m√°k</h3> <p>A <code class="highlighter-rouge">MirrorWriter</code>-rel az a tapasztalat, hogy √©rdekes dolgokat produk√°l. <strong>Bizonyos URL-ekb≈ël √©n azt l√°tom, hogy nem k√©pes (valid) f√°jlnevet gener√°lni,</strong> teh√°t az a let√∂lt√∂tt b√°jthalmaz elveszik az √©terben. Konkr√©tan √©n ezt <code class="highlighter-rouge">/?a=b/c</code> alak√∫ relat√≠v linkekn√©l tapasztaltam.</p> <p>Ami nagy probl√©ma, hogy a parszere el√©g √©rdekes felfog√°s ment√©n lett implement√°lva. A Heritrix <strong>mindenhonnan ki akar parszolni URL-t,</strong> onnan is, ahol nincs. Kutat a CSS-ekben, JS-ben, √©s gazdagon kapok olyan f√°jlokat, amelyek neve egy st√≠luslapon haszn√°lt szelektor, vagy egy szkriptben haszn√°lt felt√©tel egyik fele. üòÉ</p> <p>A forr√°sk√≥dban azt l√°ttam, hogy ilyen <em>‚Äúlikely-URL‚Äù</em>-eket keres, teh√°t ami <em>‚Äúolyasmi, mint egy URL‚Äù</em>‚Ä¶ Tal√°lkoztam olyan mappan√©vvel is, ami egy komplett <code class="highlighter-rouge">&lt;iframe&gt;</code> tag volt.</p> <p>Itt nyilv√°n felmer√ºl az emberben, hogy esetleg nem ez a ‚Äúsmart crawler‚Äù a hib√°s, hanem az adott oldal forr√°sk√≥dja‚Ä¶ de egyr√©szt ezt nem egy oldaln√°l csin√°lja, m√°sr√©szt pedig ezeket az adott oldalakat a <a href="https://www.gnu.org/software/wget/">WGET</a> hibamentesen leszedte.</p> <p>Azt olvastam, hogy √©rdemes kikapcsolni a job konfigban az <code class="highlighter-rouge">ExtractorJS</code> √©s <code class="highlighter-rouge">ExtractorCSS</code> modulokat, mert √≠gy megszabadulok ezekt≈ël a felesleges f√°jlokt√≥l (amelyek egy√©bk√©nt n√∂velik az id≈ë- √©s t√°rig√©nyt, valamint redund√°ns adatot tartalmaznak!) - de m√©g nem pr√≥b√°ltam ki. üôÇ</p> <p>Tov√°bbi √©szrev√©tel a k√∂zelm√∫ltb√≥l: Drupal-os oldalt nem tud j√≥l kezelni, kaptam egy ilyen URL-t a crawl log-ban:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://***/calendar/month/2013-06/field/theme/sites/all/modules/ctools/css/sites/all/modules/ctools/css/modules/user/user.css
</code></pre></div></div> <p>‚Ä¶amiben √©n egy ciklust v√©lek felfedezni. Term√©szetesen a let√∂lt√∂tt f√°jl sem egy st√≠luslap lett, hanem egy HTML, val√≥sz√≠n≈±leg a Drupal rendszer olyan j√≥sz√≠v≈±, hogy 404 hibalap helyett visszadobja a leghosszabb valid prefix-hez tartoz√≥ lapot. B√°r tal√°n pont azzal j√°rtunk volna jobban, ha hib√°t ad vissza, mert akkor nem keletkezik redund√°ns adat‚Ä¶ no mindegy. üôÇ</p> </div> </div> <div class="row mt-3"> <div class="col text-center"> <script> if (!window.scripts) window.scripts = []; window.scripts = window.scripts.concat('https://connect.facebook.net/hu_HU/sdk.js#xfbml=1&version=v3.0'); </script> <div class="fb-like" data-href="https://juzraai.github.io/blog/2013/heritrix-3-konfig-receptkonyv/" data-layout="button_count" data-action="like" data-size="large" data-show-faces="false" data-share="true"></div> </div> </div> <div class="row my-5 border-top"> <div class="col-md-8 mt-3"> <big class="font-weight-normal text-dark"> <strong>Zsolt vagyok,</strong> full-stack fejleszt≈ë. </big> <br> Crawlereket, webalkalmaz√°sokat, statikus honlapokat √©s interakt√≠v vizualiz√°ci√≥kat k√©sz√≠tek. </div> <div class="col mt-3 small"> <ul class="list-unstyled d-flex d-md-block pl-md-3"> <li class="mr-3 mr-md-0"><a href="/projects/hu/" target="">Munk√°im</a></li> <li class="mr-3 mr-md-0"><a href="/blog/hu/" target="">Feljegyz√©seim</a></li> <li class="mr-3 mr-md-0"><a href="https://github.com/juzraai" target="_blank">GitHub</a></li> <li class="mr-3 mr-md-0"><a href="/contact/hu/" target="">Kontakt</a></li> </ul> </div> </div> <div class="row"> <div class="col mb-3 small text-center text-muted"> Copyright &copy; 2018 Zsolt Jur√°nyi | All rights reserved. </div> </div> </div> <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.1/js/bootstrap.min.js"></script> <script>$(function () { $('a[href^=http]').attr('target', '_blank'); })</script> <script> if (!window.scripts) window.scripts = []; window.scripts = window.scripts.concat('https://www.googletagmanager.com/gtag/js?id=UA-41050675-1'); window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-41050675-1', { 'anonymize_ip': true }); </script> <div id="cc" style="display:none"> <div class="c" onclick="ccClear()"></div> <div class="p"> <p> A honlap helyes m≈±k√∂d√©s√©hez √©s n√©mi statisztik√°hoz szeretn√©k s√ºtiket haszn√°lni. <a href="/privacy/hu/">R√©szletek</a> </p> <div class="r"> <a href="javascript:void(0)" onclick="ccDeny()">Elrejt√©s</a> <a class="b" href="javascript:void(0)" onclick="ccAllow()">Enged√©lyezem</a> </div> </div> </div> <script> /* js-cookie v2.2.0 */ !function(e){var n=!1;if("function"==typeof define&&define.amd&&(define(e),n=!0),"object"==typeof exports&&(module.exports=e(),n=!0),!n){var o=window.Cookies,t=window.Cookies=e();t.noConflict=function(){return window.Cookies=o,t}}}(function(){function e(){for(var e=0,n={};e<arguments.length;e++){var o=arguments[e];for(var t in o)n[t]=o[t]}return n}function n(o){function t(n,r,i){var c;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(i=e({path:"/"},t.defaults,i)).expires){var a=new Date;a.setMilliseconds(a.getMilliseconds()+864e5*i.expires),i.expires=a}i.expires=i.expires?i.expires.toUTCString():"";try{/^[\{\[]/.test(c=JSON.stringify(r))&&(r=c)}catch(e){}r=o.write?o.write(r,n):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),n=(n=(n=encodeURIComponent(String(n))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var s="";for(var f in i)i[f]&&(s+="; "+f,!0!==i[f]&&(s+="="+i[f]));return document.cookie=n+"="+r+s}n||(c={});for(var p=document.cookie?document.cookie.split("; "):[],d=/(%[0-9A-Z]{2})+/g,u=0;u<p.length;u++){var l=p[u].split("="),C=l.slice(1).join("=");this.json||'"'!==C.charAt(0)||(C=C.slice(1,-1));try{var g=l[0].replace(d,decodeURIComponent);if(C=o.read?o.read(C,g):o(C,g)||C.replace(d,decodeURIComponent),this.json)try{C=JSON.parse(C)}catch(e){}if(n===g){c=C;break}n||(c[g]=C)}catch(e){}}return c}}return t.set=t,t.get=function(e){return t.call(t,e)},t.getJSON=function(){return t.apply({json:!0},[].slice.call(arguments))},t.defaults={},t.remove=function(n,o){t(n,"",e(o,{expires:-1}))},t.withConverter=n,t}return n(function(){})}); function addClass(element, className) { element.className += ' ' + className; } function removeClass(element, className) { element.className = element.className.replace( new RegExp('( |^)' + className + '( |$)', 'g'), ' ').trim(); } var c = 'juzraai-cc-v1'; function ccInit() { var v = Cookies.get(c); var e = document.getElementById('cc'); if ('allow' == v) { e.style.display = 'none'; ccLoadScripts(); } else { if ('deny' == v) { addClass(e, 'small'); } else { removeClass(e, 'small'); } e.style.display = null; } } function ccAllow() { Cookies.set(c, 'allow', { expires: 365 }); ccInit(); } function ccClear() { Cookies.remove(c); ccInit(); } function ccDeny() { Cookies.set(c, 'deny', { expires: 7 }); ccInit(); } function ccLoadScripts() { if (!window.scripts) window.scripts = []; for (var i = 0; i < window.scripts.length; i++) { var script = document.createElement('script'); script.src = window.scripts[i]; document.body.appendChild(script); } } ccInit(); </script> </body> </html>
